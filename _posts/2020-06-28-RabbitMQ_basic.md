---
title: "RabbitMQ基础"
date: 2020-06-28
category: MQ
tags: [RabbitMQ,Basics]
excerpt: 本文主要介绍RabbitMQ的基本概念
---

# 六种工作模式

## simple简单模式
1. 流程：生产者将消息放入队列，消费者(consumer) 监听(while) 消息队列,如果队列中有消息,就消费掉,消息被拿走后,自动从队列中删除；
2. 存在问题：消息可能没有被消费者正确处理,已经从队列中消失了,造成消息的丢失)；
3. 应用场景：聊天(作为中间过度的服务器)。

## work工作模式
1. 流程：生产者将消息放入消息队列，消费者可以有多个，同时监听一个队列，竞争消息队列内容，谁先拿到谁消费；
2. 存在问题：高并发情况下可能出现一个消息被多个消费者消费的情况；
3. 应用场景：红包;大项目中的资源调度(任务分配系统不需知道哪一个任务执行系统在空闲,直接将任务扔到消息队列中,空闲的系统自动争抢)。

## direct--路由模式
1. 流程：
   1. 生产者将消息发送给交换机按照路由判断,路由是字符串(info)，当前产生的消息携带路由字符(对象的方法),交换机根据路由的key,只能匹配上路由key对应的消息队列,对应的消费者才能消费消息;
   2. 根据业务功能定义路由字符串,从系统的代码逻辑中获取对应的功能字符串,将消息任务扔到对应的队列中；
2. 应用场景：错误通知客户通知，利用key路由,可以将程序中的错误封装成消息传入到消息队列中,开发者可以自定义消费者,实时接收错误。

## fanout--发布/订阅模式
1. 流程：生产者将消息放入交换机,交换机发布订阅把消息发送到所有消息队列中,对应消息队列的消费者拿到消息进行消费；
2. 应用场景：邮件群发,群聊天,广播(广告)。

## topic--匹配订阅模式
1. 流程：
   1. 路由功能添加模糊匹配,'\*'和'#'代表通配符，'\*'代表多个单词,'#'代表一个单词；
   2. 生产者产生消息,把消息交给交换机，交换机根据key的规则模糊匹配到对应的队列,由队列的监听消费者接收消息消费；
2. 应用场景：与direct差不多，但更加灵活。

## Headers
1. 流程：
   1. 主要通过发送的request message中的header进行匹配；
   2. 其中匹配规则（x-match）又分为all和any，all代表必须所有的键值对匹配，any代表只要有一个键值对匹配即可；
   3. headers exchange的默认匹配规则（x-match）是any。